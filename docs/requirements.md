# 家具の家 No.1 予約システム 要件定義書

**バージョン**: 2.0
**作成日**: 2025年1月
**最終更新**: 2026年1月
**プロジェクト**: 民泊予約システム
**本番URL**: https://booking.furniturehouse1.com/

---

## 1. プロジェクト概要

### 1.1 背景
坂茂氏による1995年の建築作品「家具の家 No.1」を活用した1日1組限定の宿泊・ワークショップ施設において、既存の公式サイト（https://furniturehouse1.com/）と別途運用されているSaaS予約システムを統合し、ユーザー体験の向上と運営効率化を実現する。

### 1.2 目的
- 公式サイトと予約システムの一体化によるシームレスな予約体験の提供
- ダイナミックプライシングによる収益最大化
- 管理者の運営業務効率化
- ブランドイメージに統一されたデザインの実現

### 1.3 スコープ

#### 対象範囲（実装済み）

- 宿泊予約機能（1日1組限定）
- オンライン決済機能（Stripe与信確保→審査→決済確定フロー）
- 予約管理ダッシュボード
- 自動メール配信機能
- クーポン管理機能
- ダイナミックプライシング機能（拡張料金システム）
- 多言語対応（日本語・英語）
- レビュー・評価機能
- 会員機能（Firebase Authentication）
- ゲストガイド機能
- 清掃タスク管理機能
- サポーター管理機能
- メッセージング機能

#### 対象外

- モバイルアプリ
- ワークショップ予約機能（日帰り利用）

---

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 宿泊予約機能

**概要**: ユーザーが1日1組限定の宿泊予約を行う機能

**詳細要件**:

1. **予約カレンダー表示**
   - FR-101: 月次カレンダーで空き状況を表示すること
   - FR-102: 予約済み日、利用不可日を視覚的に区別すること
   - FR-103: 過去の日付は選択不可とすること
   - FR-104: 前月・次月への移動が可能であること
   - FR-105: チェックイン日とチェックアウト日を選択できること

2. **予約情報入力**
   - FR-106: 宿泊人数（1-10名）を選択できること
   - FR-107: ゲスト氏名（必須）を入力できること
   - FR-108: メールアドレス（必須）を入力できること
   - FR-109: 電話番号（必須）を入力できること
   - FR-110: クーポンコード（任意）を入力できること
   - FR-111: 備考欄（任意）に特別なリクエストを入力できること

3. **料金表示**
   - FR-112: 基本料金を表示すること
   - FR-113: 適用される割引を表示すること
   - FR-114: 合計金額を表示すること
   - FR-115: 宿泊日数を表示すること

4. **予約確定**
   - FR-116: 入力内容のバリデーションを行うこと
   - FR-117: 決済ページへ遷移すること

#### 2.1.2 ワークショップ予約機能

**概要**: ユーザーが日帰りワークショップ利用の予約を行う機能

**詳細要件**:

1. **日程選択**
   - FR-201: 月次カレンダーで空き状況を表示すること
   - FR-202: 利用日を1日単位で選択できること

2. **時間帯選択**
   - FR-203: 午前（9:00-13:00）を選択できること
   - FR-204: 午後（14:00-18:00）を選択できること
   - FR-205: 1日（9:00-18:00）を選択できること
   - FR-206: 各時間帯の料金を表示すること

3. **予約情報入力**
   - FR-207: 参加予定人数（1-20名）を入力できること
   - FR-208: 主催者名/団体名（必須）を入力できること
   - FR-209: メールアドレス（必須）を入力できること
   - FR-210: 電話番号（必須）を入力できること
   - FR-211: ワークショップ内容（必須）を入力できること
   - FR-212: クーポンコード（任意）を入力できること

#### 2.1.3 ダイナミックプライシング機能

**概要**: 需要と供給、時期に応じて動的に価格を調整する機能

**詳細要件**:

1. **基本料金**
   - FR-301: 宿泊基本料金: 30,000円/泊
   - FR-302: ワークショップ午前/午後: 15,000円
   - FR-303: ワークショップ1日: 25,000円

2. **シーズン料金調整**
   - FR-304: ハイシーズン（4-5月、10-11月）: 基本料金×1.3
   - FR-305: ローシーズン（1-2月、8月）: 基本料金×0.8
   - FR-306: レギュラーシーズン（その他）: 基本料金×1.0

3. **曜日調整**
   - FR-307: 平日（月-木）: ×0.9
   - FR-308: 週末（金-日）: ×1.2

4. **早期予約割引**
   - FR-309: 60日前以上の予約: 15%割引
   - FR-310: 30日前以上の予約: 10%割引

5. **直前割引**
   - FR-311: 3-7日前の予約: 20%割引

6. **クーポン割引**
   - FR-312: 有効なクーポンコード入力時に指定の割引を適用すること
   - FR-313: 複数の割引が同時適用されないこと（最も有利な割引のみ適用）

#### 2.1.4 決済機能

**概要**: Stripeを利用したオンライン決済機能

**詳細要件**:

1. **決済処理**
   - FR-401: Stripe Payment Intentを生成すること
   - FR-402: クレジットカード決済に対応すること
   - FR-403: 日本円（JPY）での決済に対応すること
   - FR-404: 決済完了後に予約を確定すること

2. **セキュリティ**
   - FR-405: カード情報をサーバーに保存しないこと
   - FR-406: PCI DSS準拠の決済処理を行うこと
   - FR-407: 3Dセキュア認証に対応すること

3. **決済失敗時**
   - FR-408: エラーメッセージを表示すること
   - FR-409: 予約を確定せずに再試行を促すこと

#### 2.1.5 予約管理ダッシュボード

**概要**: 管理者が予約を管理する機能

**詳細要件**:

1. **統計表示**
   - FR-501: 今月の予約件数を表示すること
   - FR-502: 今月の売上を表示すること
   - FR-503: 保留中の予約件数を表示すること
   - FR-504: 総予約件数を表示すること

2. **予約一覧**
   - FR-505: すべての予約を一覧表示すること
   - FR-506: ステータス別にフィルタリングできること
   - FR-507: 予約ID、ゲスト名、タイプ、日程、金額、ステータスを表示すること
   - FR-508: 予約詳細を閲覧できること

3. **予約ステータス管理**
   - FR-509: 予約ステータスを「保留中」「確定」「キャンセル」「完了」で管理すること
   - FR-510: ステータスを変更できること

4. **予約検索**
   - FR-511: ゲスト名で検索できること
   - FR-512: 日付範囲で検索できること
   - FR-513: 予約IDで検索できること

#### 2.1.6 カレンダー管理機能

**概要**: 管理者が施設の利用可能日を管理する機能

**詳細要件**:

1. **利用可能日設定**
   - FR-601: 特定の日をブロック（利用不可）に設定できること
   - FR-602: ブロック理由を記録できること
   - FR-603: ブロックを解除できること

2. **一括設定**
   - FR-604: 期間を指定してブロックできること
   - FR-605: 曜日を指定してブロックできること

#### 2.1.7 クーポン管理機能

**概要**: 管理者が割引クーポンを管理する機能

**詳細要件**:

1. **クーポン作成**
   - FR-701: クーポンコードを設定できること
   - FR-702: 割引タイプ（固定額/パーセンテージ）を選択できること
   - FR-703: 割引値を設定できること
   - FR-704: 最小利用金額を設定できること（任意）
   - FR-705: 最大割引額を設定できること（任意）
   - FR-706: 有効期間を設定できること
   - FR-707: 利用回数上限を設定できること（任意）
   - FR-708: 適用可能な予約タイプを設定できること（任意）

2. **クーポン管理**
   - FR-709: クーポン一覧を表示できること
   - FR-710: クーポンを編集できること
   - FR-711: クーポンを無効化できること
   - FR-712: クーポンの利用状況を確認できること

#### 2.1.8 自動メール配信機能

**概要**: 予約に関する自動メール配信機能

**詳細要件**:

1. **予約確認メール**
   - FR-801: 予約完了時に自動送信すること
   - FR-802: 予約内容（日程、人数、金額）を含むこと
   - FR-803: 予約IDを含むこと
   - FR-804: キャンセルポリシーを含むこと

2. **リマインダーメール**
   - FR-805: 宿泊3日前に自動送信すること
   - FR-806: アクセス情報を含むこと
   - FR-807: チェックイン時間を含むこと

3. **キャンセル通知メール**
   - FR-808: キャンセル時に自動送信すること
   - FR-809: 返金情報を含むこと

4. **メールテンプレート管理**
   - FR-810: 管理者がメールテンプレートを編集できること
   - FR-811: 変数（ゲスト名、予約ID等）を使用できること

#### 2.1.9 価格設定管理機能

**概要**: 管理者が料金設定を管理する機能

**詳細要件**:

1. **基本料金設定**
   - FR-901: 宿泊基本料金を設定できること
   - FR-902: ワークショップ料金を設定できること

2. **シーズン料金設定**
   - FR-903: シーズン期間を設定できること
   - FR-904: シーズン料金倍率を設定できること

3. **割引設定**
   - FR-905: 早期予約割引の条件と割引率を設定できること
   - FR-906: 直前割引の条件と割引率を設定できること

### 2.2 非機能要件

#### 2.2.1 パフォーマンス要件

1. **応答時間**
   - NFR-101: ページ初回読み込み時間は3秒以内であること
   - NFR-102: ページ遷移時間は1秒以内であること
   - NFR-103: API応答時間は2秒以内であること

2. **スループット**
   - NFR-104: 同時接続ユーザー数100人に対応すること

#### 2.2.2 可用性要件

1. **稼働率**
   - NFR-201: システム稼働率99.5%以上を維持すること

2. **障害復旧**
   - NFR-202: 障害発生時、4時間以内に復旧すること

#### 2.2.3 セキュリティ要件

1. **認証・認可**
   - NFR-301: 管理者ダッシュボードは認証が必要であること
   - NFR-302: Firebase Authenticationを使用すること

2. **データ保護**
   - NFR-303: 通信はHTTPSで暗号化すること
   - NFR-304: 個人情報はFirestore Security Rulesで保護すること
   - NFR-305: クレジットカード情報はサーバーに保存しないこと

3. **アクセス制御**
   - NFR-306: 管理者のみが管理機能にアクセスできること
   - NFR-307: ユーザーは自分の予約情報のみ閲覧できること

#### 2.2.4 ユーザビリティ要件

1. **レスポンシブデザイン**
   - NFR-401: スマートフォン（480px以下）に対応すること
   - NFR-402: タブレット（768px以下）に対応すること
   - NFR-403: デスクトップに対応すること

2. **アクセシビリティ**
   - NFR-404: キーボード操作に対応すること
   - NFR-405: 適切なコントラスト比を維持すること

3. **多言語対応**
   - NFR-406: 日本語をサポートすること
   - NFR-407: （Phase 2）英語をサポートすること

#### 2.2.5 互換性要件

1. **ブラウザ対応**
   - NFR-501: Chrome最新版に対応すること
   - NFR-502: Safari最新版に対応すること
   - NFR-503: Firefox最新版に対応すること
   - NFR-504: Edge最新版に対応すること

#### 2.2.6 保守性要件

1. **コード品質**
   - NFR-601: TypeScriptで型安全性を確保すること
   - NFR-602: ESLintでコード品質を維持すること
   - NFR-603: 適切なコメントを記述すること

2. **ドキュメント**
   - NFR-604: README.mdに環境構築手順を記載すること
   - NFR-605: API仕様書を作成すること

#### 2.2.7 スケーラビリティ要件

1. **データ拡張**
   - NFR-701: 年間500件の予約に対応すること
   - NFR-702: 10,000件の予約履歴を保持できること

2. **機能拡張**
   - NFR-703: 新機能追加が容易な設計であること
   - NFR-704: モジュラー構造を採用すること

---

## 3. データ要件

### 3.1 データモデル

#### 3.1.1 予約（Bookings）

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | string | ○ | 予約ID（自動生成） |
| userId | string | ○ | ユーザーID |
| type | BookingType | ○ | 予約タイプ（stay/workshop） |
| startDate | Timestamp | ○ | 開始日 |
| endDate | Timestamp | ○ | 終了日 |
| guestCount | number | ○ | 人数 |
| guestName | string | ○ | ゲスト名 |
| guestEmail | string | ○ | メールアドレス |
| guestPhone | string | ○ | 電話番号 |
| guestPostalCode | string | ○ | 郵便番号 |
| guestAddress | string | ○ | 住所 |
| guestOccupation | string | ○ | 職業 |
| isForeignNational | boolean | ○ | 外国籍フラグ |
| guestNationality | string | - | 国籍（外国籍の場合） |
| guestPassportNumber | string | - | パスポート番号（外国籍の場合） |
| status | BookingStatus | ○ | ステータス |
| paymentStatus | PaymentStatus | ○ | 支払いステータス |
| totalAmount | number | ○ | 合計金額 |
| baseAmount | number | ○ | 基本料金 |
| discountAmount | number | ○ | 割引額 |
| couponId | string | - | クーポンID |
| stripePaymentIntentId | string | - | Stripe決済ID |
| notes | string | - | 備考 |
| createdAt | Timestamp | ○ | 作成日時 |
| updatedAt | Timestamp | ○ | 更新日時 |

#### 3.1.2 ユーザー（Users）

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | string | ○ | ユーザーID |
| email | string | ○ | メールアドレス |
| displayName | string | ○ | 表示名 |
| phone | string | - | 電話番号 |
| role | UserRole | ○ | 役割（admin/user） |
| createdAt | Timestamp | ○ | 作成日時 |
| updatedAt | Timestamp | ○ | 更新日時 |

#### 3.1.3 クーポン（Coupons）

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | string | ○ | クーポンID |
| code | string | ○ | クーポンコード |
| discountType | DiscountType | ○ | 割引タイプ |
| discountValue | number | ○ | 割引値 |
| minAmount | number | - | 最小利用金額 |
| maxDiscount | number | - | 最大割引額 |
| validFrom | Timestamp | ○ | 有効期間開始 |
| validUntil | Timestamp | ○ | 有効期間終了 |
| usageLimit | number | - | 利用回数上限 |
| usageCount | number | ○ | 利用回数 |
| isActive | boolean | ○ | 有効/無効 |
| applicableTypes | BookingType[] | - | 適用可能タイプ |
| createdAt | Timestamp | ○ | 作成日時 |
| updatedAt | Timestamp | ○ | 更新日時 |

#### 3.1.4 価格設定（PricingSettings）

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | string | ○ | 設定ID |
| type | BookingType | ○ | 予約タイプ |
| basePrice | number | ○ | 基本料金 |
| seasonalPricing | SeasonalPrice[] | ○ | シーズン料金 |
| weekdayMultiplier | number | ○ | 平日倍率 |
| weekendMultiplier | number | ○ | 週末倍率 |
| lastMinuteDiscount | object | - | 直前割引設定 |
| earlyBirdDiscount | object | - | 早期割引設定 |
| createdAt | Timestamp | ○ | 作成日時 |
| updatedAt | Timestamp | ○ | 更新日時 |

#### 3.1.5 カレンダー設定（CalendarSettings）

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | string | ○ | 設定ID |
| date | Timestamp | ○ | 日付 |
| isAvailable | boolean | ○ | 利用可能 |
| reason | string | - | ブロック理由 |
| createdAt | Timestamp | ○ | 作成日時 |
| updatedAt | Timestamp | ○ | 更新日時 |

#### 3.1.6 メールテンプレート（EmailTemplates）

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | string | ○ | テンプレートID |
| type | EmailType | ○ | メールタイプ |
| subject | string | ○ | 件名 |
| body | string | ○ | 本文 |
| variables | string[] | ○ | 使用可能変数 |
| createdAt | Timestamp | ○ | 作成日時 |
| updatedAt | Timestamp | ○ | 更新日時 |

### 3.2 データ保持期間

- **予約データ**: 永続保存
- **ユーザーデータ**: 永続保存
- **クーポンデータ**: 永続保存
- **ログデータ**: 90日間保存

---

## 4. システムアーキテクチャ

### 4.1 技術スタック

#### フロントエンド

- **フレームワーク**: Nuxt 3
- **UIライブラリ**: Vue 3
- **言語**: TypeScript
- **スタイリング**: TailwindCSS
- **状態管理**: Composables（Vue 3 Composition API）

#### バックエンド

- **ランタイム**: Nitro（Nuxt Server）
- **データベース**: Firebase Firestore
- **認証**: Firebase Authentication
- **ファイルストレージ**: Firebase Storage
- **ホスティング**: Vercel

#### 決済

- **決済プラットフォーム**: Stripe（Payment Intent、Webhook）

#### メール送信

- **メール配信**: Gmail SMTP（Nodemailer）

### 4.2 インフラ構成

```text
[クライアント（ブラウザ）]
    ↓ HTTPS
[Vercel Edge Network]
    ↓
[Nuxt 3 (Nitro Runtime)]
    ↓
[Firebase Firestore] ← [Firebase Authentication]
    ↓
[Server API (Nitro)] ← [Stripe API]
    ↓
[Gmail SMTP]
```

### 4.3 セキュリティ対策

1. **通信の暗号化**: すべての通信をHTTPSで暗号化
2. **認証**: Firebase Authenticationによるユーザー認証
3. **認可**: Firestore Security Rulesによるアクセス制御
4. **データ検証**: クライアント・サーバー両方でバリデーション
5. **決済セキュリティ**: Stripeによるカード情報の直接処理（サーバー非経由）

---

## 5. ユーザーストーリー

### 5.1 ゲストユーザー

**US-01: 宿泊予約**
```
As a ゲストユーザー
I want カレンダーから空き日程を確認して宿泊予約をする
So that 「家具の家 No.1」での特別な体験ができる

受入基準:
- カレンダーで空き状況を確認できる
- チェックイン・チェックアウト日を選択できる
- ゲスト情報を入力できる
- 料金が自動計算される
- クーポンコードを適用できる
- オンライン決済ができる
- 予約確認メールを受信できる
```

**US-02: ワークショップ予約**
```
As a ゲストユーザー
I want 建築空間でワークショップを開催するための予約をする
So that 独特な空間でイベントを実施できる

受入基準:
- 日程を選択できる
- 時間帯（午前/午後/1日）を選択できる
- 参加人数を入力できる
- ワークショップ内容を記載できる
- 料金が表示される
- オンライン決済ができる
```

**US-03: 予約内容の確認**
```
As a ゲストユーザー
I want 予約確認メールで予約内容を確認する
So that 予約情報を把握できる

受入基準:
- 予約完了時にメールを受信できる
- 予約ID、日程、金額が記載されている
- キャンセルポリシーが記載されている
```

### 5.2 管理者

**US-04: 予約管理**
```
As a 管理者
I want すべての予約を一覧で確認・管理する
So that 効率的に運営できる

受入基準:
- すべての予約を一覧表示できる
- ステータスでフィルタリングできる
- 予約詳細を確認できる
- ステータスを変更できる
```

**US-05: カレンダー管理**
```
As a 管理者
I want 施設のメンテナンス日など利用不可日を設定する
So that 予約を適切にコントロールできる

受入基準:
- 特定の日をブロックできる
- ブロック理由を記録できる
- ブロックを解除できる
```

**US-06: クーポン発行**
```
As a 管理者
I want キャンペーン用のクーポンを発行する
So that 集客を促進できる

受入基準:
- クーポンコードを作成できる
- 割引率または割引額を設定できる
- 有効期間を設定できる
- 利用状況を確認できる
```

**US-07: 価格設定**
```
As a 管理者
I want 基本料金やシーズン料金を設定する
So that 適切な価格戦略を実行できる

受入基準:
- 基本料金を変更できる
- シーズン料金を設定できる
- 割引条件を設定できる
```

---

## 6. 画面遷移図

```
[トップページ]
    ├─ [宿泊予約ボタン] → [宿泊予約ページ]
    │                      ├─ カレンダー表示
    │                      ├─ 日程選択
    │                      ├─ ゲスト情報入力
    │                      ├─ 料金表示
    │                      └─ [予約確定] → [決済ページ] → [完了ページ]
    │
    ├─ [ワークショップ予約ボタン] → [ワークショップ予約ページ]
    │                                ├─ カレンダー表示
    │                                ├─ 日程・時間帯選択
    │                                ├─ 主催者情報入力
    │                                ├─ 料金表示
    │                                └─ [予約確定] → [決済ページ] → [完了ページ]
    │
    └─ [管理者ログイン] → [管理ダッシュボード]
                           ├─ [予約管理タブ]
                           │   └─ 予約一覧・詳細
                           ├─ [カレンダー管理タブ]
                           │   └─ 利用可能日設定
                           ├─ [クーポン管理タブ]
                           │   └─ クーポン作成・編集
                           └─ [設定タブ]
                               └─ 価格設定
```

---

## 7. 制約事項

### 7.1 技術的制約
- Firebaseの無料枠制限を考慮した設計
- Stripeの日本国内決済対応
- ブラウザのローカルストレージ容量制限

### 7.2 ビジネス制約
- 1日1組限定の予約受付
- 日本国内ユーザーのみ対象（Phase 1）
- 決済手数料を価格に含む

### 7.3 運用制約
- 管理者アカウントは1つのみ（Phase 1）
- 予約のキャンセルは手動対応（Phase 1）

---

## 8. リスク管理

### 8.1 技術リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| Firebase障害 | 高 | 低 | バックアップデータの定期取得 |
| Stripe API障害 | 高 | 低 | エラーハンドリングとリトライ機能 |
| セキュリティ脆弱性 | 高 | 中 | 定期的なセキュリティ監査 |
| パフォーマンス低下 | 中 | 中 | キャッシュ戦略の実装 |

### 8.2 ビジネスリスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| ダブルブッキング | 高 | 低 | Firestoreトランザクション使用 |
| 決済エラー | 高 | 中 | エラーログ監視とアラート |
| データ損失 | 高 | 低 | 定期的なバックアップ |

---

## 9. 成功基準

### 9.1 定量的指標

1. **予約システム統合率**: 100%（既存Saas予約システムからの移行完了）
2. **システム稼働率**: 99.5%以上
3. **ページ読み込み時間**: 3秒以内
4. **予約コンバージョン率**: 15%以上
5. **平均予約単価**: 35,000円以上（ダイナミックプライシング効果）

### 9.2 定性的指標

1. **ユーザー体験**: シームレスな予約フロー
2. **ブランド統一性**: 既存サイトとの一体感
3. **管理者満足度**: 運営業務の効率化実感
4. **保守性**: 新機能追加が容易

---

## 10. フェーズ計画

### Phase 1（MVP - 完了）

- [x] プロジェクト基盤構築
- [x] 宿泊予約機能
- [x] ダイナミックプライシング
- [x] Stripe決済統合（与信確保→審査→決済確定フロー）
- [x] 管理ダッシュボード基本機能
- [x] Firebase本番環境設定
- [x] 自動メール配信実装
- [x] 本番デプロイ（Vercel）

### Phase 2（機能拡張 - 完了）

- [x] 多言語対応（日本語・英語）
- [x] 会員機能（Firebase Authentication）
- [x] 予約履歴・マイページ
- [x] レビュー・評価機能
- [x] キャンセル機能の自動化
- [x] 清掃タスク管理機能
- [x] サポーター管理機能
- [x] ゲストガイド機能
- [x] メッセージング機能

### Phase 3（本番運用 - 完了）

- [x] セキュリティ強化（レート制限、CSP、セキュリティヘッダー）
- [x] 運用ログ・監視機能
- [x] 整合性チェック機能
- [x] 与信期限自動管理
- [x] パフォーマンス最適化（@nuxt/image、キャッシュ設定、プリコネクト）
- [x] SEO対策強化（robots.txt、sitemap.xml、構造化データ、メタタグ強化）

### 将来の検討事項

- [ ] ワークショップ予約機能
- [ ] モバイルアプリ
- [ ] A/Bテスト機能
- [ ] レコメンデーション機能

---

## 11. 用語集

| 用語 | 定義 |
|------|------|
| 家具の家 No.1 | 坂茂氏による1995年の建築作品 |
| 1日1組限定 | 同一日に複数の予約を受け付けない運用方式 |
| ダイナミックプライシング | 需要と供給、時期に応じた動的価格設定 |
| チェックイン | 宿泊開始日 |
| チェックアウト | 宿泊終了日 |
| ワークショップ | 日帰り施設利用 |
| ハイシーズン | 需要が高い時期（4-5月、10-11月） |
| ローシーズン | 需要が低い時期（1-2月、8月） |
| 早期予約割引 | 宿泊日の30-60日前予約時の割引 |
| 直前割引 | 宿泊日の3-7日前予約時の割引 |

---

## 12. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトオーナー | | | |
| プロダクトマネージャー | | | |
| 技術リード | | | |

---

## 付録A: API仕様概要

### A.1 予約作成API

**エンドポイント**: `POST /api/bookings/create`

**リクエスト**:
```typescript
{
  type: 'stay' | 'workshop',
  startDate: Date,
  endDate: Date,
  guestCount: number,
  guestName: string,
  guestEmail: string,
  guestPhone: string,
  couponCode?: string,
  notes?: string
}
```

**レスポンス**:
```typescript
{
  success: boolean,
  bookingId: string,
  clientSecret: string, // Stripe Payment Intent
  amount: number
}
```

### A.2 クーポン検証API

**エンドポイント**: `POST /api/coupons/validate`

**リクエスト**:
```typescript
{
  code: string,
  amount: number,
  type: 'stay' | 'workshop'
}
```

**レスポンス**:
```typescript
{
  valid: boolean,
  discountAmount: number,
  couponId?: string
}
```

---

**文書管理**

- 最終更新日: 2026年1月20日
- 更新履歴:
  - v2.0 (2026/01/20) - 実装済み機能を反映、技術スタック・フェーズ計画を更新
  - v1.0 (2025/01) - 初版作成
