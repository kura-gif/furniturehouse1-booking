# 料金設定システム - UX/UIデザイン仕様書

## 📋 目次
1. [システム概要](#システム概要)
2. [料金設定の構成要素](#料金設定の構成要素)
3. [データモデル設計](#データモデル設計)
4. [UX/UI設計](#uxui設計)
5. [画面遷移とワークフロー](#画面遷移とワークフロー)
6. [実装の優先順位](#実装の優先順位)

---

## システム概要

### 目的
宿泊予約システムの料金を柔軟かつ正確に管理できる、使い勝手の良い管理画面を提供する。

### 主要機能
1. **基本料金設定** - Regular平日大人1人1泊の基準価格
2. **シーズン設定** - Regular / High / Off の3段階
3. **平日・休日設定** - 休日前日（金・土・祝前日）の料金調整
4. **子供料金設定** - 年齢別の料金ルール
5. **クーポン管理** - 割引率ごとのクーポンコード発行

---

## 料金設定の構成要素

### 1. 基本料金 (Base Pricing)
```
Regular平日 大人1〜2人1泊 = ¥35,000（基準価格）
※1人でも2人でも同じ料金
```

### 2. 人数別追加料金 (Guest Count Pricing)
```
1〜2人目: 基本料金に含まれる（追加料金なし）
3人目:    基本料金の 50% を追加
4人目:    3人目の追加料金の 90% を追加（調整可能）
5人目:    3人目の追加料金の 80% を追加（調整可能）
6人目:    3人目の追加料金の 70% を追加（調整可能）
```

**計算例（基本料金¥35,000の場合）:**
- 1〜2人: ¥35,000
- 3人: ¥35,000 + ¥17,500 = ¥52,500
- 4人: ¥35,000 + ¥17,500 + ¥15,750 = ¥68,250
- 5人: ¥35,000 + ¥17,500 + ¥15,750 + ¥14,000 = ¥82,250
- 6人: ¥35,000 + ¥17,500 + ¥15,750 + ¥14,000 + ¥12,250 = ¥106,750

### 3. 泊数別料金調整 (Multi-Night Pricing)
```
1泊目: 100%（基準）
2泊目: 1泊目の 90%（調整可能）
3泊目: 1泊目の 80%（調整可能）
4泊目: 1泊目の 70%（調整可能）
5泊目: 1泊目の 60%（調整可能）
6泊目以降: 5泊目と同じ料金
```

**計算例（1泊¥35,000の場合）:**
- 1泊: ¥35,000
- 2泊: ¥35,000 + ¥31,500 = ¥66,500
- 3泊: ¥35,000 + ¥31,500 + ¥28,000 = ¥94,500
- 4泊: ¥35,000 + ¥31,500 + ¥28,000 + ¥24,500 = ¥143,000
- 5泊: ¥35,000 + ¥31,500 + ¥28,000 + ¥24,500 + ¥21,000 = ¥164,000

### 4. シーズン別料金 (Seasonal Pricing)
| シーズン | 期間例 | 料金倍率 |
|---------|-------|---------|
| Regular | 通常期間 | 1.0x (基準) |
| High | GW、お盆、年末年始 | 1.3x |
| Off | 閑散期 | 0.7x |

### 5. 平日・休日料金 (Day Type Pricing)
| 曜日タイプ | 定義 | 料金調整 |
|----------|-----|---------|
| 平日 | 日〜木曜 | +¥0 (基準) |
| 休日前日 | 金・土・祝前日 | +¥10,000 |

### 6. 子供料金 (Children Pricing)
| 年齢 | 料金 |
|-----|------|
| 0〜5歳 | 無料 |
| 6〜15歳 | 大人料金の50% |
| 16歳以上 | 大人料金100% |

### 7. 割引クーポン (Discount Coupons)
- 割引率設定（5%, 10%, 15%, 20%, 25%, 30%など）
- 各割引率ごとにクーポンコード発行
- 有効期限、使用回数制限、最低利用金額などの条件設定

---

## データモデル設計

### 既存のデータ構造（改善版）

```typescript
/**
 * 子供料金ルール
 */
export interface ChildPricingRule {
  ageFrom: number // 年齢範囲開始（0歳〜）
  ageTo: number   // 年齢範囲終了（5歳まで）
  discountType: 'free' | 'percentage' // 無料 or 割引率
  discountValue: number // 割引率（percentage の場合: 50 = 50%割引）
}

/**
 * 人数別追加料金設定
 */
export interface GuestCountPricing {
  baseGuestCount: number // 基本料金に含まれる人数（1〜2人）
  thirdGuestRate: number // 3人目の追加料金率（基本料金に対する割合: 0.5 = 50%）
  additionalGuestRates: {
    fourth: number  // 4人目の料金率（3人目の追加料金に対する割合: 0.9 = 90%）
    fifth: number   // 5人目の料金率（3人目の追加料金に対する割合: 0.8 = 80%）
    sixth: number   // 6人目の料金率（3人目の追加料金に対する割合: 0.7 = 70%）
  }
}

/**
 * 泊数別料金調整設定
 */
export interface MultiNightPricing {
  rates: {
    night1: number  // 1泊目: 1.0 (100%)
    night2: number  // 2泊目: 0.9 (90%)
    night3: number  // 3泊目: 0.8 (80%)
    night4: number  // 4泊目: 0.7 (70%)
    night5: number  // 5泊目: 0.6 (60%)
    night6Plus: number // 6泊目以降: 0.6 (60%)
  }
}

/**
 * 詳細価格設定（拡張版）
 */
export interface EnhancedPricingSetting {
  id: string
  type: BookingType

  // 基本料金（1〜2人分）
  basePriceAdult: number // Regular平日大人1〜2人1泊の基準価格

  // シーズン期間定義
  seasonPeriods: SeasonPeriod[]

  // シーズン別料金倍率
  seasonMultipliers: {
    regular: number // 1.0
    high: number    // 1.3
    off: number     // 0.7
  }

  // 曜日タイプ別追加料金
  dayTypeSurcharges: {
    weekday: number  // 0円（基準）
    weekend: number  // 10,000円
  }

  // 人数別追加料金設定
  guestCountPricing: GuestCountPricing

  // 泊数別料金調整設定
  multiNightPricing: MultiNightPricing

  // 子供料金ルール
  childPricingRules: ChildPricingRule[]

  // 祝日カレンダー（祝前日判定用）
  holidayCalendar?: {
    year: number
    holidays: string[] // ['2025-01-01', '2025-05-03', ...]
  }[]

  createdAt: Timestamp
  updatedAt: Timestamp
}

/**
 * ゲスト情報（年齢情報を含む）
 */
export interface GuestInfo {
  adults: number          // 大人（16歳以上）
  children: {
    age: number           // 各子供の年齢
  }[]
}

/**
 * 料金計算結果（拡張版）
 */
export interface DetailedPriceCalculation {
  // 基本情報
  checkInDate: string
  checkOutDate: string
  numberOfNights: number

  // ゲスト情報
  guestInfo: GuestInfo
  totalGuestCount: number       // 合計人数（大人+子供）

  // 泊別料金内訳
  nightlyBreakdown: {
    nightNumber: number         // 泊数（1泊目、2泊目...）
    date: string                // 日付
    seasonType: SeasonType      // シーズンタイプ
    dayType: DayType            // 曜日タイプ

    // 基本料金計算
    basePrice: number           // 基本料金（1〜2人分）
    seasonMultiplier: number    // シーズン倍率
    dayTypeSurcharge: number    // 曜日追加料金
    basePriceAfterAdjustments: number // 調整後基本料金

    // 人数別追加料金
    guestCountCharges: {
      guest3rd?: number         // 3人目の追加料金
      guest4th?: number         // 4人目の追加料金
      guest5th?: number         // 5人目の追加料金
      guest6th?: number         // 6人目の追加料金
      total: number             // 追加料金合計
    }

    // 子供料金
    childCharges: {
      freeChildren: number      // 無料の子供の人数
      discountedChildren: number // 割引対象の子供の人数
      total: number             // 子供料金合計
    }

    // 泊数調整
    nightRate: number           // この泊の料金率（1.0, 0.9, 0.8...）
    nightRateDescription: string // 説明（例: "1泊目 100%"）

    // 小計
    subtotalBeforeNightRate: number // 泊数調整前の小計
    nightTotal: number          // 泊数調整後の1泊合計
    description: string         // 詳細説明
  }[]

  // 料金サマリー
  subtotal: number              // 小計（全泊の合計）
  couponDiscount?: number       // クーポン割引額
  totalAmount: number           // 合計金額

  // 内訳サマリー
  breakdown: {
    totalAdults: number         // 大人人数
    totalChildren: number       // 子供人数
    averagePricePerNight: number // 1泊あたり平均料金
    averagePricePerPerson: number // 1人あたり平均料金
  }
}
```

---

## UX/UI設計

### 設計原則
1. **シンプルさ優先** - 複雑な料金体系を直感的に理解・設定できる
2. **視覚的フィードバック** - 設定変更がリアルタイムでプレビューできる
3. **エラー防止** - 矛盾する設定を防ぐバリデーション
4. **柔軟性** - 様々なビジネスモデルに対応できる拡張性

---

### 画面構成

## 1. 料金設定メイン画面

```
┌─────────────────────────────────────────────────────────────┐
│ 🏠 Furniture House - 管理画面                                │
├─────────────────────────────────────────────────────────────┤
│ 予約 | クーポン | 【料金設定】 | カレンダー | メール         │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  料金設定                                    [プレビュー]     │
│                                                               │
│  ┌─────────────────────────────────────────┐              │
│  │ 📊 料金設定ナビゲーション                 │              │
│  ├─────────────────────────────────────────┤              │
│  │ ① 基本料金                    [完了 ✓]   │              │
│  │ ② 人数別料金                  [完了 ✓]   │              │
│  │ ③ 泊数別料金                  [完了 ✓]   │              │
│  │ ④ シーズン設定                [未設定]    │              │
│  │ ⑤ 平日・休日設定              [完了 ✓]   │              │
│  │ ⑥ 子供料金設定                [完了 ✓]   │              │
│  └─────────────────────────────────────────┘              │
│                                                               │
│  ┌───────────────────────────────────────────────────┐   │
│  │ ① 基本料金設定                                       │   │
│  ├───────────────────────────────────────────────────┤   │
│  │                                                       │   │
│  │  Regular平日 大人1〜2人1泊の基準価格                 │   │
│  │  ┌──────────────────┐                             │   │
│  │  │ ¥ 35,000         │  円/泊                        │   │
│  │  └──────────────────┘                             │   │
│  │                                                       │   │
│  │  💡 1人でも2人でも同じ料金です                       │   │
│  │     3人目以降は別途追加料金が発生します              │   │
│  │                                                       │   │
│  │              [料金シミュレーターで確認 →]             │   │
│  │                                                       │   │
│  └───────────────────────────────────────────────────┘   │
│                                                               │
│  ┌───────────────────────────────────────────────────┐   │
│  │ ② 人数別追加料金設定                                 │   │
│  ├───────────────────────────────────────────────────┤   │
│  │                                                       │   │
│  │  基本料金に含まれる人数: 1〜2人                      │   │
│  │                                                       │   │
│  │  3人目の追加料金                                     │   │
│  │  ┌────┐                                           │   │
│  │  │ 50 │ % （基本料金の50%）                         │   │
│  │  └────┘                                           │   │
│  │  計算例: ¥35,000 × 50% = ¥17,500                    │   │
│  │                                                       │   │
│  │  4人目以降の料金率（3人目に対する割合）             │   │
│  │  ┌─────────────────────────────────┐           │   │
│  │  │ 4人目: [90] %  → ¥15,750            │           │   │
│  │  │ 5人目: [80] %  → ¥14,000            │           │   │
│  │  │ 6人目: [70] %  → ¥12,250            │           │   │
│  │  └─────────────────────────────────┘           │   │
│  │                                                       │   │
│  │  💡 料金例（基本¥35,000の場合）:                     │   │
│  │  ・2人: ¥35,000                                      │   │
│  │  ・3人: ¥52,500  ・4人: ¥68,250                      │   │
│  │  ・5人: ¥82,250  ・6人: ¥106,750                     │   │
│  │                                                       │   │
│  └───────────────────────────────────────────────────┘   │
│                                                               │
│  ┌───────────────────────────────────────────────────┐   │
│  │ ③ 泊数別料金調整設定                                 │   │
│  ├───────────────────────────────────────────────────┤   │
│  │                                                       │   │
│  │  各泊の料金率（1泊目を基準）                         │   │
│  │  ┌─────────────────────────────────┐           │   │
│  │  │ 1泊目: 100 % （基準）                 │           │   │
│  │  │ 2泊目:  90 %                          │           │   │
│  │  │ 3泊目:  80 %                          │           │   │
│  │  │ 4泊目:  70 %                          │           │   │
│  │  │ 5泊目:  60 %                          │           │   │
│  │  │ 6泊目以降: 60 % （5泊目と同じ）       │           │   │
│  │  └─────────────────────────────────┘           │   │
│  │                                                       │   │
│  │  💡 料金例（1泊¥35,000の場合）:                      │   │
│  │  ・1泊: ¥35,000                                      │   │
│  │  ・2泊: ¥66,500  ・3泊: ¥94,500                      │   │
│  │  ・4泊: ¥143,000  ・5泊: ¥164,000                    │   │
│  │                                                       │   │
│  └───────────────────────────────────────────────────┘   │
│                                                               │
│  ┌───────────────────────────────────────────────────┐   │
│  │ ④ シーズン設定                          [期間を追加]  │   │
│  ├───────────────────────────────────────────────────┤   │
│  │                                                       │   │
│  │  📅 2025年のシーズン設定                             │   │
│  │                                                       │   │
│  │  ┌─────────────────────────────────────┐         │   │
│  │  │ 🔴 ハイシーズン         料金倍率: 1.3x    [編集]│   │
│  │  ├─────────────────────────────────────┤         │   │
│  │  │ • 03/20 - 05/06  春のGW期間                 │   │
│  │  │ • 08/01 - 08/20  夏休み期間                 │   │
│  │  │ • 12/25 - 01/05  年末年始                   │   │
│  │  └─────────────────────────────────────┘         │   │
│  │                                                       │   │
│  │  ┌─────────────────────────────────────┐         │   │
│  │  │ 🔵 オフシーズン         料金倍率: 0.7x    [編集]│   │
│  │  ├─────────────────────────────────────┤         │   │
│  │  │ • 01/06 - 02/28  冬の閑散期                 │   │
│  │  │ • 06/01 - 07/15  梅雨時期                   │   │
│  │  └─────────────────────────────────────┘         │   │
│  │                                                       │   │
│  │  ⚪ レギュラーシーズン（上記以外の期間）             │   │
│  │     料金倍率: 1.0x                                    │   │
│  │                                                       │   │
│  └───────────────────────────────────────────────────┘   │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

## 2. シーズン設定モーダル

```
┌─────────────────────────────────────────────┐
│ シーズン期間の追加                   [✕]    │
├─────────────────────────────────────────────┤
│                                               │
│  シーズンタイプ                               │
│  ⚪ レギュラー  🔴 ハイ  🔵 オフ             │
│                                               │
│  期間設定                                     │
│  ┌──────────┐  〜  ┌──────────┐          │
│  │ 03/20    │      │ 05/06    │  ✓        │
│  └──────────┘      └──────────┘            │
│                                               │
│  説明（任意）                                 │
│  ┌──────────────────────────┐             │
│  │ 春のGW期間                 │             │
│  └──────────────────────────┘             │
│                                               │
│  料金倍率                                     │
│  ┌────┐                                     │
│  │ 1.3│ x  （基本料金の130%）                │
│  └────┘                                     │
│                                               │
│  💡 プレビュー                                │
│  基本料金 ¥35,000 → ¥45,500/泊               │
│                                               │
│            [キャンセル]  [保存する]           │
│                                               │
└─────────────────────────────────────────────┘
```

## 3. 平日・休日設定

```
┌───────────────────────────────────────────────────┐
│ ③ 平日・休日設定                                   │
├───────────────────────────────────────────────────┤
│                                                     │
│  休日前日の定義                                     │
│  ☑ 金曜日                                          │
│  ☑ 土曜日                                          │
│  ☑ 祝日の前日                                      │
│                                                     │
│  休日前日の追加料金                                 │
│  ┌──────────────────┐                           │
│  │ ¥ 10,000         │  円/泊                      │
│  └──────────────────┘                           │
│                                                     │
│  祝日カレンダー                      [カレンダー管理] │
│  ┌─────────────────────────────────┐           │
│  │ 2025年の祝日: 16日登録済み           │           │
│  │ • 1月1日    元日                     │           │
│  │ • 1月13日   成人の日                 │           │
│  │ • 2月11日   建国記念の日             │           │
│  │ ...                                   │           │
│  └─────────────────────────────────┘           │
│                                                     │
│  💡 祝日カレンダーは年に1回更新してください         │
│                                                     │
└───────────────────────────────────────────────────┘
```

## 4. 子供料金設定

```
┌───────────────────────────────────────────────────┐
│ ④ 子供料金設定                                     │
├───────────────────────────────────────────────────┤
│                                                     │
│  年齢別料金ルール                    [ルールを追加] │
│                                                     │
│  ┌─────────────────────────────────────┐       │
│  │ ルール1                                [編集]  │       │
│  ├─────────────────────────────────────┤       │
│  │ 対象年齢: 0歳 〜 5歳                     │       │
│  │ 料金: 無料                               │       │
│  └─────────────────────────────────────┘       │
│                                                     │
│  ┌─────────────────────────────────────┐       │
│  │ ルール2                                [編集]  │       │
│  ├─────────────────────────────────────┤       │
│  │ 対象年齢: 6歳 〜 15歳                    │       │
│  │ 料金: 大人料金の 50% 割引                │       │
│  └─────────────────────────────────────┘       │
│                                                     │
│  ┌─────────────────────────────────────┐       │
│  │ ルール3（デフォルト）                          │       │
│  ├─────────────────────────────────────┤       │
│  │ 対象年齢: 16歳以上                       │       │
│  │ 料金: 大人料金 100%（通常料金）          │       │
│  └─────────────────────────────────────┘       │
│                                                     │
│  💡 年齢ルールは重複しないように設定してください   │
│                                                     │
└───────────────────────────────────────────────────┘
```

## 5. その他の設定

```
┌───────────────────────────────────────────────────┐
│ ⑤ その他の設定                                     │
├───────────────────────────────────────────────────┤
│                                                     │
│  泊数による割引                                     │
│  ┌─────────────────────────────────┐           │
│  │ 1泊:      割引なし（基準）           │           │
│  │ 2泊:      5% 割引                    │           │
│  │ 3泊以上:  10% 割引                   │           │
│  └─────────────────────────────────┘           │
│                                                     │
│  追加人数料金（2人目以降）                         │
│  ┌─────────────────────────────────┐           │
│  │ 大人1人あたり:  ¥10,000 / 泊        │           │
│  │ 子供1人あたり:  ¥5,000 / 泊         │           │
│  └─────────────────────────────────┘           │
│                                                     │
└───────────────────────────────────────────────────┘
```

## 6. 料金シミュレーター（サイドパネル）

```
┌─────────────────────────────────────┐
│ 💰 料金シミュレーター                │
├─────────────────────────────────────┤
│                                       │
│  チェックイン                         │
│  ┌────────────┐                     │
│  │ 2025/05/02 │                     │
│  └────────────┘                     │
│                                       │
│  チェックアウト                       │
│  ┌────────────┐                     │
│  │ 2025/05/04 │  (2泊)              │
│  └────────────┘                     │
│                                       │
│  宿泊者                               │
│  大人: [4] 人                        │
│  子供:                                │
│  • 8歳  [削除]                       │
│  • 12歳 [削除]                       │
│  [+ 子供を追加]                      │
│                                       │
│  クーポン                             │
│  ┌────────────┐                     │
│  │ SPRING20   │ [適用]              │
│  └────────────┘                     │
│                                       │
│ ─────────────────────────────────  │
│                                       │
│  📊 料金内訳                          │
│                                       │
│  【1泊目】5/2(金) ハイ・休日前日      │
│  基本(1〜2人) ¥45,500                │
│  + 3人目 ¥22,750                     │
│  + 4人目 ¥20,475                     │
│  + 子供8歳 ¥11,375                   │
│  + 子供12歳 ¥11,375                  │
│  小計: ¥111,475 × 100% = ¥111,475   │
│                                       │
│  【2泊目】5/3(土) ハイ・休日前日      │
│  基本(1〜2人) ¥45,500                │
│  + 3人目 ¥22,750                     │
│  + 4人目 ¥20,475                     │
│  + 子供8歳 ¥11,375                   │
│  + 子供12歳 ¥11,375                  │
│  小計: ¥111,475 × 90% = ¥100,327    │
│                                       │
│  合計: ¥211,802                      │
│  クーポン -20%: -¥42,360             │
│ ─────────────────────────────────  │
│  💴 お支払い金額                      │
│  ¥169,441                            │
│                                       │
│  1泊あたり平均: ¥84,720              │
│  1人あたり平均: ¥28,240              │
│                                       │
└─────────────────────────────────────┘
```

## 7. クーポン管理画面（既存を改善）

```
┌─────────────────────────────────────────────────────────────┐
│ クーポン管理                                    [+ 新規作成]  │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  クイック作成                                                 │
│  ┌─────────────────────────────────────────────┐          │
│  │ よく使う割引率からクーポンを作成              │          │
│  │                                                │          │
│  │  [5% OFF]  [10% OFF]  [15% OFF]  [20% OFF]   │          │
│  │  [25% OFF]  [30% OFF]  [カスタム...]          │          │
│  └─────────────────────────────────────────────┘          │
│                                                               │
│  アクティブなクーポン (3)              [すべて表示]          │
│  ┌─────────────────────────────────────────────┐          │
│  │ SPRING20                                   20% OFF        │
│  │ 2025/03/01 - 2025/05/31  |  使用: 15/100回               │
│  │ [編集] [無効化] [コピー]                                 │
│  ├─────────────────────────────────────────────┤          │
│  │ WELCOME10                                  10% OFF        │
│  │ 2025/01/01 - 2025/12/31  |  使用: 45回（無制限）         │
│  │ [編集] [無効化] [コピー]                                 │
│  ├─────────────────────────────────────────────┤          │
│  │ FRIEND15                                   15% OFF        │
│  │ 2025/01/01 - 2025/12/31  |  使用: 8回（無制限）          │
│  │ [編集] [無効化] [コピー]                                 │
│  └─────────────────────────────────────────────┘          │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

## 8. クーポン作成モーダル（改善版）

```
┌─────────────────────────────────────────────┐
│ クーポン新規作成                      [✕]   │
├─────────────────────────────────────────────┤
│                                               │
│  作成方法を選択                               │
│  ⚪ クイック作成  ⚪ 詳細設定                │
│                                               │
│  ┌───────────────────────────────┐        │
│  │ クイック作成モード               │        │
│  ├───────────────────────────────┤        │
│  │                                  │        │
│  │ 割引率を選択                     │        │
│  │ ⚪ 5%  ⚪ 10%  🔴 15%  ⚪ 20%    │        │
│  │ ⚪ 25%  ⚪ 30%  ⚪ カスタム       │        │
│  │                                  │        │
│  │ 有効期間                         │        │
│  │ ⚪ 1ヶ月  🔴 3ヶ月  ⚪ 6ヶ月    │        │
│  │ ⚪ 1年    ⚪ カスタム             │        │
│  │                                  │        │
│  │ クーポンコード                   │        │
│  │ ┌──────────┐  [ランダム生成]  │        │
│  │ │ AUTUMN15 │                    │        │
│  │ └──────────┘                    │        │
│  │                                  │        │
│  │ 使用回数制限（任意）             │        │
│  │ ┌──────────┐                  │        │
│  │ │ 100      │ 回まで             │        │
│  │ └──────────┘                  │        │
│  │                                  │        │
│  │ 💡 プレビュー                    │        │
│  │ コード: AUTUMN15                 │        │
│  │ 割引: 15% OFF                    │        │
│  │ 期間: 2025/09/01 - 2025/11/30   │        │
│  │ 制限: 100回まで使用可能          │        │
│  │                                  │        │
│  └───────────────────────────────┘        │
│                                               │
│            [キャンセル]  [作成する]           │
│                                               │
└─────────────────────────────────────────────┘
```

---

## 画面遷移とワークフロー

### 初期設定フロー

```
[管理者ログイン]
    ↓
[料金設定画面へ]
    ↓
[① 基本料金設定]  → 基準価格を入力（例: ¥35,000）
                    ※1〜2人分の基本料金
    ↓
[② 人数別料金設定] → 3人目: 基本の50%
                    → 4〜6人目: 3人目に対する割合を設定
                    （デフォルト: 90%, 80%, 70%）
    ↓
[③ 泊数別料金設定] → 各泊の料金率を設定
                    （デフォルト: 100%, 90%, 80%, 70%, 60%）
    ↓
[④ シーズン設定]   → ハイ・オフシーズンの期間と倍率を設定
    ↓
[⑤ 平日・休日設定] → 休日前日の定義と追加料金を設定
    ↓
[⑥ 子供料金設定]  → 年齢別の料金ルールを設定
    ↓
[料金シミュレーターで確認]
    ↓
[保存]
```

### クーポン作成フロー

```
[クーポン管理画面]
    ↓
[クイック作成 または 新規作成]
    ↓
[割引率を選択]
    ↓
[コードを入力/自動生成]
    ↓
[有効期限・使用制限を設定]
    ↓
[プレビューで確認]
    ↓
[作成]
```

---

## 実装の優先順位

### フェーズ1: コア料金設定（最優先）
- [ ] 基本料金設定UI（1〜2人分）
- [ ] 人数別追加料金設定UI
  - [ ] 3人目の料金率設定
  - [ ] 4〜6人目の料金率設定（調整可能）
- [ ] 泊数別料金調整設定UI
  - [ ] 1〜5泊目の料金率設定（各泊調整可能）
- [ ] 新しい料金計算ロジックの実装
  - [ ] 人数別計算ロジック
  - [ ] 泊数別割引計算ロジック
  - [ ] 複合計算（シーズン×曜日×人数×泊数）
- [ ] 料金シミュレーター
  - [ ] 詳細な内訳表示
  - [ ] リアルタイム計算

### フェーズ2: シーズン・曜日設定（高優先）
- [ ] シーズン設定UI（期間と倍率）
- [ ] 平日・休日設定UI
- [ ] 祝日カレンダー管理UI
- [ ] カレンダービュー（年間料金の可視化）

### フェーズ3: 子供料金（高優先）
- [ ] 子供料金ルール設定UI
- [ ] 年齢別料金計算ロジック
- [ ] 予約フォームでの子供年齢入力
- [ ] 料金内訳表示の改善

### フェーズ4: クーポン改善（中優先）
- [ ] クーポンクイック作成機能
- [ ] クーポンテンプレート機能
- [ ] クーポン使用状況ダッシュボード
- [ ] クーポンの一括管理機能

### フェーズ5: 高度な機能（低優先）
- [ ] 祝日カレンダー自動更新
- [ ] 料金履歴管理
- [ ] 料金設定のバージョン管理
- [ ] 競合他社料金比較
- [ ] A/Bテスト機能
- [ ] AIによる料金最適化提案

---

## UXのポイント

### 1. 直感的な階層構造

```
料金設定
├─ 基本料金（1〜2人分、最も重要）
├─ 人数別料金（3〜6人目の追加料金）
├─ 泊数別料金（連泊割引）
├─ シーズン設定（季節による変動）
├─ 平日・休日設定（曜日による変動）
└─ 子供料金設定（年齢による変動）
```

### 2. リアルタイムフィードバック
- 設定変更時に即座に料金シミュレーターに反映
- 矛盾する設定をその場で警告
- 視覚的なプレビュー（カレンダービュー）

### 3. テンプレート機能
- よくある設定パターンをテンプレート化
  - 「通常パターン」
  - 「ハイシーズン重視パターン」
  - 「長期滞在割引パターン」

### 4. エラー防止
- シーズン期間の重複チェック
- 料金倍率の妥当性チェック（0.3x〜3.0x の範囲内など）
- 子供料金ルールの年齢重複チェック

### 5. データの可視化
- 年間カレンダービューで料金の高低を色分け表示
- 月別平均料金のグラフ
- クーポン使用率のダッシュボード

---

## デザインシステム

### カラーパレット

```css
/* シーズンカラー */
--season-regular: #6B7280;  /* グレー */
--season-high: #EF4444;     /* レッド */
--season-off: #3B82F6;      /* ブルー */

/* 状態カラー */
--status-active: #10B981;   /* グリーン */
--status-inactive: #9CA3AF; /* グレー */
--status-warning: #F59E0B;  /* アンバー */

/* 背景カラー */
--bg-primary: #FFFFFF;
--bg-secondary: #F9FAFB;
--bg-tertiary: #F3F4F6;
```

### アイコン

- 📊 料金設定
- 📅 シーズン/カレンダー
- 💰 料金/価格
- 🎫 クーポン
- 👨👩👧👦 ゲスト/人数
- 💡 ヒント/プレビュー
- ✅ 完了/有効
- ❌ 無効/エラー

---

## まとめ

この設計により、以下のメリットが実現できます:

### 1. 柔軟な料金体系
- **人数別料金**: 1〜2人は基本料金、3人目以降は段階的な追加料金
- **泊数別割引**: 連泊するほどお得になる料金設定
- **すべて調整可能**: ビジネスニーズに応じて各パラメータを変更可能

### 2. 直感的な管理画面
- **ステップバイステップ**: 6段階のナビゲーションで迷わず設定
- **リアルタイムプレビュー**: 設定変更が即座にシミュレーターに反映
- **視覚的フィードバック**: 料金計算の詳細な内訳表示

### 3. 複雑な計算を自動化
```
最終料金 = Σ(各泊の料金)

各泊の料金 = (
  基本料金(1〜2人) +
  3人目の追加料金 +
  4〜6人目の追加料金 +
  子供料金
) × シーズン倍率 × 泊数割引率 + 曜日追加料金
```

### 4. 実装のメリット
- **正確性**: サーバーサイドで再計算・検証
- **効率性**: クイック作成機能で素早く設定
- **保守性**: 明確なデータ構造とロジック分離
- **拡張性**: 将来的な機能追加に対応できる設計

### 5. ユーザー体験
- **予約者**: 人数・泊数に応じた詳細な料金内訳を確認できる
- **管理者**: 複雑な料金設定を簡単に管理できる
- **透明性**: すべての料金計算ロジックが明確

---

この設計書をもとに、段階的に実装を進めることをお勧めします。

## 次のステップ

1. **フェーズ1の実装**: まず基本料金、人数別料金、泊数別料金の設定UIと計算ロジックを実装
2. **テスト**: 様々なパターンで料金計算が正しく動作することを確認
3. **フェーズ2以降**: シーズン設定、子供料金などを順次追加

実装のサポートが必要な場合は、お気軽にお声がけください！
